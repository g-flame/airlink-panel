<!-- Mobile Menu Container - Only visible on mobile screens -->
<div class="mobile-menu-container">
  <!-- Mobile hamburger -->
  <div class="p-3">
    <button id="mobileMenuToggle" class="relative p-2 rounded-lg text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
        d="M4 5h16a2 2 0 012 2v2a2 2 0 01-2 2H4a2 2 0 01-2-2V7a2 2 0 012-2z
           M4 13h16a2 2 0 012 2v2a2 2 0 01-2 2H4a2 2 0 01-2-2v-2a2 2 0 012-2z" />
  <circle cx="6" cy="8" r="1" fill="currentColor"/>
  <circle cx="6" cy="16" r="1" fill="currentColor"/>
</svg>

    </button>
  </div>

  <!-- Mobile overlay -->
  <div id="mobileMenuOverlay" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 transition-opacity duration-300">
    <div class="flex">
      <!-- Sidebar Menu -->
      <div id="mobileMenuSidebar" class="bg-white dark:bg-neutral-900 w-72 h-full shadow-2xl transform transition-transform duration-300 ease-out">
        <!-- Header -->
        <div class="flex items-center justify-between p-4 border-b border-neutral-200 dark:border-neutral-700">
          <h2 class="text-lg font-semibold text-neutral-900 dark:text-white">Server Menu</h2>
          <button id="closeMobileMenu" class="p-2 rounded-lg text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-all duration-200">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>

        <!-- Menu Items -->
        <div class="overflow-y-auto h-full pb-20">
          <nav role="navigation" class="p-4">
            <ul role="list" class="space-y-2">
              <%
            const mobMenuItems = global.uiComponentStore ? global.uiComponentStore.getServerMenuItems() : [];
            if (!mobMenuItems || mobMenuItems.length === 0) {
            %>
              <!-- Default Menu Items -->
              <li>
                <a href="/server/<%= server.UUID %>" class="group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-neutral-700 dark:text-neutral-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200 border border-transparent hover:border-blue-200 dark:hover:border-blue-800">
                  <div class="flex-shrink-0 w-5 h-5 mr-3 text-neutral-500 group-hover:text-blue-500">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                      <path fill-rule="evenodd" d="M2.25 6a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V6Zm3.97.97a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1 0 1.06l-2.25 2.25a.75.75 0 0 1-1.06-1.06l1.72-1.72-1.72-1.72a.75.75 0 0 1 0-1.06Zm4.28 4.28a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z" clip-rule="evenodd" />
                    </svg>
                  </div>
                  <span>Console</span>
                </a>
              </li>

              <li>
                <a href="/server/<%= server.UUID %>/files" class="group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-neutral-700 dark:text-neutral-300 hover:text-green-600 dark:hover:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-all duration-200 border border-transparent hover:border-green-200 dark:hover:border-green-800">
                  <div class="flex-shrink-0 w-5 h-5 mr-3 text-neutral-500 group-hover:text-green-500">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M19.906 9c.382 0 .749.057 1.094.162V9a3 3 0 0 0-3-3h-3.879a.75.75 0 0 1-.53-.22L11.47 3.66A2.25 2.25 0 0 0 9.879 3H6a3 3 0 0 0-3 3v3.162A3.756 3.756 0 0 1 4.094 9h15.812ZM4.094 10.5a2.25 2.25 0 0 0-2.227 2.568l.857 6A2.25 2.25 0 0 0 4.951 21H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-2.227-2.568H4.094Z" />
                    </svg>
                  </div>
                  <span>Files</span>
                </a>
              </li>

              <% if (features.includes('players')) { %>
              <li>
                <a href="/server/<%= server.UUID %>/players" class="group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-neutral-700 dark:text-neutral-300 hover:text-purple-600 dark:hover:text-purple-400 hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all duration-200 border border-transparent hover:border-purple-200 dark:hover:border-purple-800">
                  <div class="flex-shrink-0 w-5 h-5 mr-3 text-neutral-500 group-hover:text-purple-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 256 256">
                      <path d="M100,124a12,12,0,1,1,12-12A12,12,0,0,1,100,124Zm56-24a12,12,0,1,0,12,12A12,12,0,0,0,156,100Zm-4.27,45.23a45,45,0,0,1-47.46,0,8,8,0,0,0-8.54,13.54,61,61,0,0,0,64.54,0,8,8,0,0,0-8.54-13.54ZM216,80v96a32.06,32.06,0,0,1-24,31v17a16,16,0,0,1-16,16H80a16,16,0,0,1-16-16V207a32.06,32.06,0,0,1-24-31V80A32,32,0,0,1,72,48H88V32a16,16,0,0,1,16-16h48a16,16,0,0,1,16,16V48h16A32,32,0,0,1,216,80ZM104,48h48V32H104Zm72,176V208H80v16ZM200,80a16,16,0,0,0-16-16H72A16,16,0,0,0,56,80v96a16,16,0,0,0,16,16H184a16,16,0,0,0,16-16Z"></path>
                    </svg>
                  </div>
                  <span>Players</span>
                </a>
              </li>
              <% } %>

              <% if (features.includes('worlds')) { %>
              <li>
                <a href="/server/<%= server.UUID %>/worlds" class="group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-neutral-700 dark:text-neutral-300 hover:text-indigo-600 dark:hover:text-indigo-400 hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-all duration-200 border border-transparent hover:border-indigo-200 dark:hover:border-indigo-800">
                  <div class="flex-shrink-0 w-5 h-5 mr-3 text-neutral-500 group-hover:text-indigo-500">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="m20.893 13.393-1.135-1.135a2.252 2.252 0 0 1-.421-.585l-1.08-2.16a.414.414 0 0 0-.663-.107.827.827 0 0 1-.812.21l-1.273-.363a.89.89 0 0 0-.738 1.595l.587.39c.59.395.674 1.23.172 1.732l-.2.2c-.212.212-.33.498-.33.796v.41c0 .409-.11.809-.32 1.158l-1.315 2.191a2.11 2.11 0 0 1-1.81 1.025 1.055 1.055 0 0 1-1.055-1.055v-1.172c0-.92-.56-1.747-1.414-2.089l-.655-.261a2.25 2.25 0 0 1-1.383-2.46l.007-.042a2.25 2.25 0 0 1 .29-.787l.09-.15a2.25 2.25 0 0 1 2.37-1.048l1.178.236a1.125 1.125 0 0 0 1.302-.795l.208-.73a1.125 1.125 0 0 0-.578-1.315l-.665-.332-.091.091a2.25 2.25 0 0 1-1.591.659h-.18c-.249 0-.487.1-.662.274a.931.931 0 0 1-1.458-1.137l1.411-2.353a2.25 2.25 0 0 0 .286-.76m11.928 9.869A9 9 0 0 0 8.965 3.525m11.928 9.868A9 9 0 1 1 8.965 3.525" />
                    </svg>
                  </div>
                  <span>Worlds</span>
                </a>
              </li>
              <% } %>

              <li>
                <a href="/server/<%= server.UUID %>/startup" class="group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-neutral-700 dark:text-neutral-300 hover:text-orange-600 dark:hover:text-orange-400 hover:bg-orange-50 dark:hover:bg-orange-900/20 transition-all duration-200 border border-transparent hover:border-orange-200 dark:hover:border-orange-800">
                  <div class="flex-shrink-0 w-5 h-5 mr-3 text-neutral-500 group-hover:text-orange-500">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" />
                    </svg>
                  </div>
                  <span>Startup</span>
                </a>
              </li>

              <li>
                <a href="/server/<%= server.UUID %>/settings" class="group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-neutral-700 dark:text-neutral-300 hover:text-gray-600 dark:hover:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-900/20 transition-all duration-200 border border-transparent hover:border-gray-200 dark:hover:border-gray-800">
                  <div class="flex-shrink-0 w-5 h-5 mr-3 text-neutral-500 group-hover:text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                      <path fill-rule="evenodd" d="M11.078 2.25c-.917 0-1.699.663-1.85 1.567L9.05 4.889c-.02.12-.115.26-.297.348a7.493 7.493 0 0 0-.986.57c-.166.115-.334.126-.45.083L6.3 5.508a1.875 1.875 0 0 0-2.282.819l-.922 1.597a1.875 1.875 0 0 0 .432 2.385l.84.692c.095.078.17.229.154.43a7.598 7.598 0 0 0 0 1.139c.015.2-.059.352-.153.43l-.841.692a1.875 1.875 0 0 0-.432 2.385l.922 1.597a1.875 1.875 0 0 0 2.282.818l1.019-.382c.115-.043.283-.031.45.082.312.214.641.405.985.57.182.088.277.228.297.35l.178 1.071c.151.904.933 1.567 1.85 1.567h1.844c.916 0 1.699-.663 1.85-1.567l.178-1.072c.02-.12.114-.26.297-.349.344-.165.673-.356.985-.57.167-.114.335-.125.45-.082l1.02.382a1.875 1.875 0 0 0 2.28-.819l.923-1.597a1.875 1.875 0 0 0-.432-2.385l-.84-.692c-.095-.078-.17-.229-.154-.43a7.614 7.614 0 0 0 0-1.139c-.016-.2.059-.352.153-.43l.84-.692c.708-.582.891-1.59.433-2.385l-.922-1.597a1.875 1.875 0 0 0-2.282-.818l-1.02.382c-.114.043-.282.031-.449-.083a7.49 7.49 0 0 0-.985-.57c-.183-.087-.277-.227-.297-.348l-.179-1.072a1.875 1.875 0 0 0-1.85-1.567h-1.843ZM12 15.75a3.75 3.75 0 1 0 0-7.5 3.75 3.75 0 0 0 0 7.5Z" clip-rule="evenodd" />
                    </svg>
                  </div>
                  <span>Settings</span>
                </a>
              </li>

              <% } else {
                mobMenuItems.forEach(item => {
                  if (item.feature && !features.includes(item.feature)) return;
                  const url = item.url.replace(':uuid', server.UUID);
            %>
              <!-- Dynamic Menu Items -->
              <li>
                <a href="<%= url %>" class="group flex items-center px-4 py-3 text-sm font-medium rounded-xl text-neutral-700 dark:text-neutral-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-200 border border-transparent hover:border-blue-200 dark:hover:border-blue-800">
                  <div class="flex-shrink-0 w-5 h-5 mr-3 text-neutral-500 group-hover:text-blue-500">
                    <%- item.icon %>
                  </div>
                  <span><%= item.label %></span>
                </a>
              </li>
              <% }); } %>
            </ul>
          </nav>
        </div>
      </div>

      <!-- Click area to close menu -->
      <div class="flex-1" id="mobileMenuClickArea"></div>
    </div>
  </div>
</div> <!-- End mobile-menu-container -->

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const openBtn = document.getElementById("mobileMenuToggle");
    const closeBtn = document.getElementById("closeMobileMenu");
    const overlay = document.getElementById("mobileMenuOverlay");
    const sidebar = document.getElementById("mobileMenuSidebar");
    const clickArea = document.getElementById("mobileMenuClickArea");

    function openMenu() {
      overlay.classList.remove("hidden");
      // Force reflow
      overlay.offsetHeight;
      overlay.classList.add("opacity-100");
      sidebar.classList.remove("-translate-x-full");
    }

    function closeMenu() {
      overlay.classList.remove("opacity-100");
      sidebar.classList.add("-translate-x-full");
      setTimeout(() => {
        overlay.classList.add("hidden");
      }, 300);
    }

    openBtn.addEventListener("click", openMenu);
    closeBtn.addEventListener("click", closeMenu);
    clickArea.addEventListener("click", closeMenu);

    // Close on escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !overlay.classList.contains("hidden")) {
        closeMenu();
      }
    });
  });
</script>

<style>
  /* Force hide mobile menu on screens larger than 640px */
  @media (min-width: 640px) {

    #mobileMenuToggle,
    #mobileMenuOverlay,
    .mobile-menu-container {
      display: none !important;
      visibility: hidden !important;
    }
  }

  /* Show only on mobile screens */
  @media (max-width: 639px) {
    .mobile-menu-container {
      display: block !important;
    }
  }

  /* Ensure initial state */
  #mobileMenuSidebar {
    transform: translateX(-100%);
  }

  #mobileMenuOverlay.opacity-100 #mobileMenuSidebar {
    transform: translateX(0);
  }

  /* Custom scrollbar for mobile menu */
  #mobileMenuSidebar::-webkit-scrollbar {
    width: 6px;
  }

  #mobileMenuSidebar::-webkit-scrollbar-track {
    background: transparent;
  }

  #mobileMenuSidebar::-webkit-scrollbar-thumb {
    background: rgba(156, 163, 175, 0.5);
    border-radius: 3px;
  }

  #mobileMenuSidebar::-webkit-scrollbar-thumb:hover {
    background: rgba(156, 163, 175, 0.7);
  }
</style>